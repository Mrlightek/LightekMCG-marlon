# MARLON FRAMEWORK CONTEXT FOR CONTINUE

## 1. Project Overview
- Standalone Ruby framework by Lightek Media & Communications Group
- Avoids Rails; modular gem with CLI, generators, DB abstraction, migrations
- Supports SQLite and Postgres
- Provides hot-reload server and CLI playground
- Supports DevOps integrations (systemd, proxy generators)

---

## 2. Project Structure

lib/marlon/
cli.rb
cli/commands/.rb
generators/.rb
db.rb
db_adapter.rb
db_connector.rb
migrator.rb
installer.rb
server.rb
systemd_manager.rb
config/
database.yml
db/
migrate/*.rb


---

## 3. CLI Overview

**CLI Base:** `Marlon::CLI` (inherits Thor)

### Basic commands

```ruby
marlon install             # Runs Installer.new.run
marlon server [PORT]       # Starts Falcon server with DB connection
marlon watch               # Starts server with hot-reload and playground
marlon g GENERATOR NAME    # Runs a generator: model, migration, scaffold, service, systemd, proxy
marlon db:setup            # Establish DB connection + run migrations
marlon db:migrate          # Run pending migrations
marlon console             # Start interactive IRB console with models loaded
marlon version             # Shows Marlon version
marlon g:command NAME      # Generate CLI command + generator + service
marlon g:module NAME       # Generate full Marlon module


CLI Generators
Generators::ModelGenerator → creates lib/marlon/models/<name>.rb
Generators::MigrationGenerator → creates db/migrate/<timestamp>_<name>.rb
Generators::CommandGenerator → creates lib/marlon/cli/commands/<name>_command.rb
Generators::ModuleGenerator → creates full Marlon module structure
4. Database Layer
DB Module: Marlon::DB

Marlon::DB.connect(:main, adapter: :sqlite, file: "dev.db")
Marlon::DB.connect(:main, adapter: :postgres, db: "marlon", host: "localhost", user: "marlon", password: "secret")

Marlon::DB.save("users", { "id" => "1", "name" => "Alice" })
Marlon::DB.find("users", "1")
Marlon::DB.where("users", { "name" => "Alice" })
Marlon::DB.update("users", "1", { "name" => "Bob" })
Marlon::DB.delete("users", "1")

DBAdapter: manages environment configs
Marlon::DBAdapter.establish_connection("development")

DBConnector: reads config/database.yml
development:
  adapter: sqlite
  file: dev.db

production:
  adapter: postgres
  db: marlon
  host: localhost
  user: marlon
  password: secret

5. Migrations
Migrator: Marlon::Migrator

migrator = Migrator.new
migrator.run   # Runs pending migrations in db/migrate/

Migration Example:
class CreateUsers
  def self.up
    Marlon::DB.ensure_table("users", {
      "id" => :string,
      "name" => :string,
      "email" => :string
    })
  end
end


Applied migrations tracked in marlon_schema_migrations table
Version recorded automatically

6. Generators Examples
ModelGenerator

Generators::ModelGenerator.new("User", ["name:string", "email:string"]).generate
# Creates lib/marlon/models/user.rb

MigrationGenerator
Generators::MigrationGenerator.new("create_users").generate
# Creates db/migrate/<timestamp>_create_users.rb

CommandGenerator
Generators::CommandGenerator.new("Notify").generate
# Creates lib/marlon/cli/commands/notify_command.rb

7. CLI Command Example
module Marlon::CLI::Commands
  class NotifyCommand
    def self.run(*args)
      puts "Running NotifyCommand with args: #{args.inspect}"
    end
  end
end

Invoke:
marlon notify hello world
# Output: Running NotifyCommand with args: ["hello", "world"]

8. Hot Reload & Watch
marlon watch -b 0.0.0.0 -p 3000
# Starts server with AutoWatcher and playground

9. Conventions / Patterns
No Rails: pure Ruby gem
Thor CLI: commands, generators, watch, console
DB: SQLite or Postgres, no ORM
Migrations: ruby files, up method only
Generators: scaffold files and directories
Hot reload: optional, for development
Naming: snake_case files, CamelCase classes
Files are modular: CLI, DB, generators, server
10. Example Workflows
Create user model + migration + CLI command

marlon g:model User name:string email:string
marlon g:migration create_users
marlon g:command Notify
marlon db:setup
marlon db:migrate
marlon console

Save and query users

Marlon::DB.save("users", { "id" => "1", "name" => "Alice" })
user = Marlon::DB.find("users", "1")
users_named_alice = Marlon::DB.where("users", { "name" => "Alice" })
Marlon::DB.update("users", "1", { "name" => "Bob" })
Marlon::DB.delete("users", "1")

Generate CLI command and run it

marlon g:command Notify
marlon notify "Hello World"

11. Sample Data for Continue
Tables: users, orders, products, marlon_schema_migrations
Models: User, Order, Product
CLI commands: NotifyCommand, InstallCommand, ServerCommand
Migrations: CreateUsers, CreateOrders, AddEmailToUsers

